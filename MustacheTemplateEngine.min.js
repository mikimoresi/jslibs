/*
 mustache.js - Logic-less {{mustache}} templates with JavaScript
 http://github.com/janl/mustache.js
*/
(function(m,t){"object"===typeof exports&&exports?t(exports):"function"===typeof define&&define.amd?define(["exports"],t):t(m.Mustache={})})(this,function(m){function t(a){return"function"===typeof a}function A(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function E(a,c){function b(p){"string"===typeof p&&(p=p.split(F,2));if(!B(p)||2!==p.length)throw Error("Invalid tags: "+p);e=new RegExp(A(p[0])+"\\s*");q=new RegExp("\\s*"+A(p[1]));z=new RegExp("\\s*"+A("}"+p[1]))}if(!a)return[];var d=
[],h=[],f=[],u=!1,l=!1,e,q,z;b(c||m.tags);for(var k=new y(a),r,g,n,v;!k.eos();){r=k.pos;if(n=k.scanUntil(e)){v=0;for(var G=n.length;v<G;++v)if(g=n.charAt(v),H.call(I,g)?l=!0:f.push(h.length),h.push(["text",g,r,r+1]),r+=1,"\n"===g){if(u&&!l)for(;f.length;)delete h[f.pop()];else f=[];l=u=!1}}if(!k.scan(e))break;u=!0;g=k.scan(J)||"name";k.scan(K);"="===g?(n=k.scanUntil(D),k.scan(D),k.scanUntil(q)):"{"===g?(n=k.scanUntil(z),k.scan(L),k.scanUntil(q),g="&"):n=k.scanUntil(q);if(!k.scan(q))throw Error("Unclosed tag at "+
k.pos);v=[g,n,r,k.pos];h.push(v);if("#"===g||"^"===g)d.push(v);else if("/"===g){g=d.pop();if(!g)throw Error('Unopened section "'+n+'" at '+r);if(g[1]!==n)throw Error('Unclosed section "'+g[1]+'" at '+r);}else"name"===g||"{"===g||"&"===g?l=!0:"="===g&&b(n)}if(g=d.pop())throw Error('Unclosed section "'+g[1]+'" at '+k.pos);return M(N(h))}function N(a){for(var c=[],b,d,h=0,f=a.length;h<f;++h)if(b=a[h])"text"===b[0]&&d&&"text"===d[0]?(d[1]+=b[1],d[3]=b[3]):(c.push(b),d=b);return c}function M(a){for(var c=
[],b=c,d=[],h,f=0,u=a.length;f<u;++f)switch(h=a[f],h[0]){case "#":case "^":b.push(h);d.push(h);b=h[4]=[];break;case "/":b=d.pop();b[5]=h[2];b=0<d.length?d[d.length-1][4]:c;break;default:b.push(h)}return c}function y(a){this.tail=this.string=a;this.pos=0}function w(a,c){this.view=null==a?{}:a;this.cache={".":this.view};this.parent=c}function x(){this.cache={}}var O=Object.prototype.toString,B=Array.isArray||function(a){return"[object Array]"===O.call(a)},H=RegExp.prototype.test,I=/\S/,P={"&":"&amp;",
"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},K=/\s*/,F=/\s+/,D=/\s*=/,L=/\s*\}/,J=/#|\^|\/|>|\{|&|=|!/;y.prototype.eos=function(){return""===this.tail};y.prototype.scan=function(a){a=this.tail.match(a);if(!a||0!==a.index)return"";a=a[0];this.tail=this.tail.substring(a.length);this.pos+=a.length;return a};y.prototype.scanUntil=function(a){a=this.tail.search(a);switch(a){case -1:var c=this.tail;this.tail="";break;case 0:c="";break;default:c=this.tail.substring(0,a),this.tail=this.tail.substring(a)}this.pos+=
c.length;return c};w.prototype.push=function(a){return new w(a,this)};w.prototype.lookup=function(a){var c=this.cache;if(a in c)var b=c[a];else{for(var d=this,h,f;d;){if(0<a.indexOf("."))for(b=d.view,h=a.split("."),f=0;null!=b&&f<h.length;)b=b[h[f++]];else b=d.view[a];if(null!=b)break;d=d.parent}c[a]=b}t(b)&&(b=b.call(this.view));return b};x.prototype.clearCache=function(){this.cache={}};x.prototype.parse=function(a,c){var b=this.cache,d=b[a];null==d&&(d=b[a]=E(a,c));return d};x.prototype.render=
function(a,c,b){var d=this.parse(a);c=c instanceof w?c:new w(c);return this.renderTokens(d,c,b,a)};x.prototype.renderTokens=function(a,c,b,d){function h(g){return u.render(g,c,b)}for(var f="",u=this,l,e,q=0,z=a.length;q<z;++q)switch(l=a[q],l[0]){case "#":e=c.lookup(l[1]);if(!e)continue;if(B(e))for(var k=0,r=e.length;k<r;++k)f+=this.renderTokens(l[4],c.push(e[k]),b,d);else if("object"===typeof e||"string"===typeof e)f+=this.renderTokens(l[4],c.push(e),b,d);else if(t(e)){if("string"!==typeof d)throw Error("Cannot use higher-order sections without the original template");
e=e.call(c.view,d.slice(l[3],l[5]),h);null!=e&&(f+=e)}else f+=this.renderTokens(l[4],c,b,d);break;case "^":e=c.lookup(l[1]);if(!e||B(e)&&0===e.length)f+=this.renderTokens(l[4],c,b,d);break;case ">":if(!b)continue;e=t(b)?b(l[1]):b[l[1]];null!=e&&(f+=this.renderTokens(this.parse(e),c,b,e));break;case "&":e=c.lookup(l[1]);null!=e&&(f+=e);break;case "name":e=c.lookup(l[1]);null!=e&&(f+=m.escape(e));break;case "text":f+=l[1]}return f};m.name="mustache.js";m.version="0.8.1";m.tags=["{{","}}"];var C=new x;
m.clearCache=function(){return C.clearCache()};m.parse=function(a,c){return C.parse(a,c)};m.render=function(a,c,b){return C.render(a,c,b)};m.to_html=function(a,c,b,d){a=m.render(a,c,b);if(t(d))d(a);else return a};m.escape=function(a){return String(a).replace(/[&<>"'\/]/g,function(c){return P[c]})};m.Scanner=y;m.Context=w;m.Writer=x});